<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Planillas</title>
    <script>
        function toggleFechaInputs() {
            const tipo = document.getElementById('tipo').value;
            document.getElementById('input_fecha_semana').style.display = tipo === 'semanal' ? 'inline' : 'none';
            document.getElementById('input_fecha_mes').style.display = tipo === 'mensual' ? 'inline' : 'none';
        }
        window.onload = toggleFechaInputs;
    </script>
</head>
<body>
    <h1>Listado de Planillas</h1>

    <form method="get" action="/admin/planillas">
        <label for="tipo">Tipo de Planilla:</label>
        <select name="tipo" id="tipo" onchange="toggleFechaInputs()">
            <option value="mensual" {% if tipo == 'mensual' %}selected{% endif %}>Mensual</option>
            <option value="semanal" {% if tipo == 'semanal' %}selected{% endif %}>Semanal</option>
        </select>

        <span id="input_fecha_mes" style="display:none">
            <label for="fecha_mensual">Mes:</label>
            <input type="month" name="fecha_mensual" value="{{ fecha_mensual or '' }}">
        </span>

        <span id="input_fecha_semana" style="display:none">
            <label for="fecha_semanal">Fecha base:</label>
            <input type="date" name="fecha_semanal" value="{{ fecha_semanal or '' }}">
        </span>

        <button type="submit">Filtrar</button>
    </form>

    {% if planillas %}
        <table border="1">
            <thead>
                <tr>
                    <th>Empleado</th>
                    {% if tipo == 'semanal' %}
                        <th>Horas Ordinarias</th>
                        <th>Horas Extra</th>
                        <th>Salario Bruto</th>
                        <th>Deducciones</th>
                        <th>Salario Neto</th>
                        <th>Semana</th>
                    {% else %}
                        <th>Mes</th>
                        <th>Monto Total</th>
                        <th>Fecha de Cálculo</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for p in planillas %}
                    <tr>
                        <td>{{ p.nombreCompleto }}</td>
                        {% if tipo == 'semanal' %}
                            <td>{{ p.horasOrdinarias }}</td>
                            <td>{{ p.horasExtra }}</td>
                            <td>{{ p.montoBruto }}</td>
                            <td>{{ p.montoDeducciones }}</td>
                            <td>{{ p.montoNeto }}</td>
                            <td>{{ p.semanaInicio }} a {{ p.semanaFin }}</td>
                        {% else %}
                            <td>{{ p.mes }}</td>
                            <td>{{ p.montoTotal }}</td>
                            <td>{{ p.fechaCalculo }}</td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No se encontraron planillas para los criterios seleccionados.</p>
    {% endif %}

    {% if planillas %}
        <h2>Resumen</h2>
        <p>Total de Planillas: {{ planillas|length }}</p>
        {% if tipo == 'semanal' %}
            <p>Total Horas Ordinarias: {{ total_horas_ordinarias }}</p>
            <p>Total Horas Extra: {{ total_horas_extra }}</p>
            <p>Total Salario Bruto: {{ total_salario_bruto }}</p>
            <p>Total Deducciones: {{ total_deducciones }}</p>
            <p>Total Salario Neto: {{ total_salario_neto }}</p>
        {% else %}
            <p>Monto Total de Planillas: {{ monto_total_planillas }}</p>
        {% endif %}
    {% else %}
        <p>No se encontraron resultados.</p>
    {% endif %}

    <a href="/menu_admin">Volver al menú</a>
</body>
</html>
